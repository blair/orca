@SET_MAKE@

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
libdir		= @libdir@
INSTALL		= @INSTALL@
MKDIR		= @MKDIR@
PERL_HEAD	= @PERL_HEAD@
VAR_DIR		= @VAR_DIR@
RRD_DIR		= @RRD_DIR@
RRDTOOL_DIR	= @RRDTOOL_DIR@
PROCALLATOR_DIR = $(VAR_DIR)/procallator
PERL_SCRIPTS	= procallator.pl
SHELL_SCRIPTS	= procallator install.sh update_orca_server.sh
TARGETS		= $(PERL_SCRIPTS) $(SHELL_SCRIPTS)

all:		Makefile $(TARGETS) procallator.cfg

install: all
		$(MKDIR) $(bindir)
		$(MKDIR) $(libdir)
		$(MKDIR) $(RRD_DIR)/procallator
		@for file in $(TARGETS); do			\
			echo $(INSTALL) $$file $(bindir);	\
			$(INSTALL) $$file $(bindir);		\
		done
		if test -r $(libdir)/procallator.cfg; then	\
			cp -p $(libdir)/procallator.cfg $(libdir)/procallator.cfg.`date +%Y-%m-%d-%H:%M:%S`; \
		fi
		$(INSTALL) -m 0644 procallator.cfg $(libdir)
		$(INSTALL) -m 0755 procallator.pl $(libdir)

procallator_run_at_boot: all
		-$(RM) /etc/init.d/procallator /etc/rc0.d/K01procallator
		-$(RM) /etc/rc1.d/K01procallator /etc/rc3.d/S99procallator
		$(INSTALL) -m 0744 S99procallator /etc/init.d/procallator
		ln /etc/init.d/procallator /etc/rc0.d/K01procallator
		ln /etc/init.d/procallator /etc/rc1.d/K01procallator
		ln /etc/init.d/procallator /etc/rc3.d/S99procallator

clean:
		$(RM) $(TARGETS) procallator.cfg

distclean:	clean
		$(RM) *.sh Makefile

.SUFFIXES:	.pl .sh

.pl:		$(PERL_HEAD)
		cat $(PERL_HEAD) $< > $@
		chmod 0755 $@

.sh:
		cp $< $@
		chmod 0755 $@
		chmod 0755 procallator

Makefile:	Makefile.in
		cd ../.. && CONFIG_FILES=contrib/procallator/Makefile ./config.status
		chmod 755 *.pl *.sh procallator
		$(MAKE)

procallator.cfg:			procallator.cfg.in
		cd ../.. && CONFIG_FILES=contrib/procallator/procallator.cfg ./config.status

procallator.pl:		procallator.pl.in	$(PERL_HEAD)
		cd ../.. && CONFIG_FILES=contrib/procallator/procallator.pl ./config.status
		cat $(PERL_HEAD) procallator.pl > procallator.perl
		mv procallator.perl procallator.pl
		chmod 0755 procallator.pl

procallator:	procallator.in
		cd ../.. && CONFIG_FILES=contrib/procallator/procallator ./config.status
		chmod 0755 procallator

install.sh:	install.sh.in
		cd ../.. && CONFIG_FILES=contrib/procallator/install.sh ./config.status
		chmod 0755 install.sh

update_orca_server.sh: update_orca_server.sh.in
		cd ../.. && CONFIG_FILES=contrib/procallator/update_orca_server.sh ./config.status
		chmod 0755 update_orca_server.sh
