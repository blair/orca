@SET_MAKE@

prefix                = @prefix@
exec_prefix           = @exec_prefix@
libdir                = @libdir@
INSTALL               = @INSTALL@
MKDIR                 = @MKDIR@
PERL                  = @PERL@

all: Makefile \
     orca_logo.gif.hex \
     rrdtool_logo.gif.hex \
     rothschild_image_logo.png.hex

# Create a hex file representation of orca_logo.gif that can be stored
# inside orca.pl.
orca_logo.gif.hex: orca_logo.gif
	$(PERL) -e 'while (sysread(STDIN, $$b, 35)){print unpack("h*", $$b),"\n"}' < $< > $@

# Create a hex file representation of rrdtool_logo.gif that can be
# stored inside orca.pl.
rrdtool_logo.gif.hex: rrdtool_logo.gif
	$(PERL) -e 'while (sysread(STDIN, $$b, 35)){print unpack("h*", $$b),"\n"}' < $< > $@

# Create a hex file representation of rothschild_image_logo.png that
# can be stored inside orca.pl.
rothschild_image_logo.png.hex: rothschild_image_logo.png
	$(PERL) -e 'while (sysread(STDIN, $$b, 35)){print unpack("h*", $$b),"\n"}' < $< > $@

install: all
	$(MKDIR) $(libdir)/Orca
	$(MKDIR) $(libdir)/SE/3.2.1
	$(MKDIR) $(libdir)/SE/3.3
	$(MKDIR) $(libdir)/SE/3.3.1
	@for f in Orca/*.pm; do \
	  echo $(INSTALL) -m 0644 $$f $(libdir)/Orca; \
	  $(INSTALL) -m 0644 $$f $(libdir)/Orca; \
	done
	@if test -d Orca/Config; then \
	  $(MKDIR) $(libdir)/Orca/Config; \
	  for f in Orca/Config/*.pm; do \
	    echo $(INSTALL) -m 0644 $$f $(libdir)/Orca/Config; \
	    $(INSTALL) -m 0644 $$f $(libdir)/Orca/Config; \
	  done; \
	fi
	@for d in SE/*; do \
	  test ! -d $$d && continue; \
	  for f in $$d/*; do \
	    test ! -f $$f && continue; \
	    echo $(INSTALL) -m 0644 $$f $(libdir)/$$d; \
	    $(INSTALL) -m 0644 $$f $(libdir)/$$d; \
	  done \
	done
	@echo 'cd ..; svnversion . 2>/dev/null'
	@current_rev="`cd ..; svnversion . 2>/dev/null`"; \
	if test "$$current_rev" != "" && \
           test "$$current_rev" != "exported"; then \
	  echo "Found good svnversion for `cd ..; pwd`: $$current_rev"; \
	  echo $(PERL) -w -p -i \
	    -e 's/^(\$$ORCA_VER_REVISION\s*=\s*).*/$${1}"'$$current_rev'";/' \
	    $(libdir)/Orca/Constants.pm; \
	  $(PERL) -w -p -i \
	    -e 's/^(\$$ORCA_VER_REVISION\s*=\s*).*/$${1}"'$$current_rev'";/' \
	    $(libdir)/Orca/Constants.pm; \
	fi

clean:

distclean: clean
	$(RM) Makefile

Makefile: Makefile.in
	cd .. && CONFIG_FILES=lib/Makefile ./config.status
