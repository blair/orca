@SET_MAKE@

PERL                             = @PERL@
CFLAGS                           = @CFLAGS@

# By default, pass UNINST=1 down to the Perl Makefile's so that any
# old installed Perl modules are properly deleted.  Otherwise, the
# Perl installation may have the old and new modules installed and and
# due to Perl's module search order, Perl may use the older module
# instead of the newer installed module.
UNINST                           = 1

data_dumper_dir                  = @DATA_DUMPER_DIR@
date_parse_dir                   = @DATE_PARSE_DIR@
devel_dprof_dir                  = @DEVEL_DPROF_DIR@
digest_md5_dir                   = @DIGEST_MD5_DIR@
math_intervalsearch_dir          = @MATH_INTERVALSEARCH_DIR@
rrdtool_dir                      = @RRDTOOL_DIR@
storable_dir                     = @STORABLE_DIR@

MAKE_DATA_DUMPER                 = @MAKE_DATA_DUMPER@
MAKE_DATE_PARSE                  = @MAKE_DATE_PARSE@
MAKE_DEVEL_DPROF                 = @MAKE_DEVEL_DPROF@
MAKE_DIGEST_MD5                  = @MAKE_DIGEST_MD5@
MAKE_MATH_INTERVALSEARCH         = @MAKE_MATH_INTERVALSEARCH@
MAKE_RRDTOOL                     = @MAKE_RRDTOOL@
MAKE_STORABLE                    = @MAKE_STORABLE@
MAKE_TARGETS                     = $(MAKE_DATA_DUMPER) \
                                   $(MAKE_DATE_PARSE) \
                                   $(MAKE_DEVEL_DPROF) \
                                   $(MAKE_DIGEST_MD5) \
                                   $(MAKE_MATH_INTERVALSEARCH) \
                                   $(MAKE_RRDTOOL) \
                                   $(MAKE_STORABLE)

TEST_DATA_DUMPER                 = @TEST_DATA_DUMPER@
TEST_DATE_PARSE                  = @TEST_DATE_PARSE@
TEST_DEVEL_DPROF                 = @TEST_DEVEL_DPROF@
TEST_DIGEST_MD5                  = @TEST_DIGEST_MD5@
TEST_MATH_INTERVALSEARCH         = @TEST_MATH_INTERVALSEARCH@
TEST_RRDTOOL                     = @TEST_RRDTOOL@
TEST_STORABLE                    = @TEST_STORABLE@
TEST_TARGETS                     = $(TEST_DATA_DUMPER) \
                                   $(TEST_DATE_PARSE) \
                                   $(TEST_DEVEL_DPROF) \
                                   $(TEST_DIGEST_MD5) \
                                   $(TEST_MATH_INTERVALSEARCH) \
                                   $(TEST_RRDTOOL) \
                                   $(TEST_STORABLE)

INSTALL_PERL_DATA_DUMPER         = @INSTALL_PERL_DATA_DUMPER@
INSTALL_PERL_DATE_PARSE          = @INSTALL_PERL_DATE_PARSE@
INSTALL_PERL_DEVEL_DPROF         = @INSTALL_PERL_DEVEL_DPROF@
INSTALL_PERL_DIGEST_MD5          = @INSTALL_PERL_DIGEST_MD5@
INSTALL_PERL_MATH_INTERVALSEARCH = @INSTALL_PERL_MATH_INTERVALSEARCH@
INSTALL_PERL_RRDTOOL             = @INSTALL_PERL_RRDTOOL@
INSTALL_PERL_STORABLE            = @INSTALL_PERL_STORABLE@
INSTALL_PERL_TARGETS             = $(INSTALL_PERL_DATA_DUMPER) \
                                   $(INSTALL_PERL_DATE_PARSE) \
                                   $(INSTALL_PERL_DEVEL_DPROF) \
                                   $(INSTALL_PERL_DIGEST_MD5) \
                                   $(INSTALL_PERL_MATH_INTERVALSEARCH) \
                                   $(INSTALL_PERL_RRDTOOL) \
                                   $(INSTALL_PERL_STORABLE)

INSTALL_LIB_RRDTOOL              = @INSTALL_LIB_RRDTOOL@
INSTALL_LIB_TARGETS              = $(INSTALL_LIB_RRDTOOL)

CLEAN_DATA_DUMPER                = @CLEAN_DATA_DUMPER@
CLEAN_DATE_PARSE                 = @CLEAN_DATE_PARSE@
CLEAN_DEVEL_DPROF                = @CLEAN_DEVEL_DPROF@
CLEAN_DIGEST_MD5                 = @CLEAN_DIGEST_MD5@
CLEAN_MATH_INTERVALSEARCH        = @CLEAN_MATH_INTERVALSEARCH@
CLEAN_RRDTOOL                    = @CLEAN_RRDTOOL@
CLEAN_STORABLE                   = @CLEAN_STORABLE@
CLEAN_TARGETS                    = $(CLEAN_DATA_DUMPER) \
                                   $(CLEAN_DATE_PARSE) \
                                   $(CLEAN_DEVEL_DPROF) \
                                   $(CLEAN_DIGEST_MD5) \
                                   $(CLEAN_MATH_INTERVALSEARCH) \
                                   $(CLEAN_RRDTOOL) \
                                   $(CLEAN_STORABLE)

DISTCLEAN_DATA_DUMPER            = @DISTCLEAN_DATA_DUMPER@
DISTCLEAN_DATE_PARSE             = @DISTCLEAN_DATE_PARSE@
DISTCLEAN_DEVEL_DPROF            = @DISTCLEAN_DEVEL_DPROF@
DISTCLEAN_DIGEST_MD5             = @DISTCLEAN_DIGEST_MD5@
DISTCLEAN_MATH_INTERVALSEARCH    = @DISTCLEAN_MATH_INTERVALSEARCH@
DISTCLEAN_RRDTOOL                = @DISTCLEAN_RRDTOOL@
DISTCLEAN_STORABLE               = @DISTCLEAN_STORABLE@
DISTCLEAN_TARGETS                = $(DISTCLEAN_DATA_DUMPER) \
                                   $(DISTCLEAN_DATE_PARSE) \
                                   $(DISTCLEAN_DEVEL_DPROF) \
                                   $(DISTCLEAN_DIGEST_MD5) \
                                   $(DISTCLEAN_MATH_INTERVALSEARCH) \
                                   $(DISTCLEAN_RRDTOOL) \
                                   $(DISTCLEAN_STORABLE)

all: Makefile $(MAKE_TARGETS)

make_data_dumper: $(data_dumper_dir)/Makefile
	cd $(data_dumper_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)"

$(data_dumper_dir)/Makefile: $(data_dumper_dir)/Makefile.PL $(PERL)
	cd $(data_dumper_dir) && $(PERL) Makefile.PL

make_date_parse: $(date_parse_dir)/Makefile
	cd $(date_parse_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)"

$(date_parse_dir)/Makefile: $(date_parse_dir)/Makefile.PL $(PERL)
	cd $(date_parse_dir) && $(PERL) Makefile.PL

make_devel_dprof: $(devel_dprof_dir)/Makefile
	cd $(devel_dprof_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)"

$(devel_dprof_dir)/Makefile: $(devel_dprof_dir)/Makefile.PL $(PERL)
	cd $(devel_dprof_dir) && $(PERL) Makefile.PL

make_digest_md5: $(digest_md5_dir)/Makefile
	cd $(digest_md5_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)"

$(digest_md5_dir)/Makefile: $(digest_md5_dir)/Makefile.PL $(PERL)
	cd $(digest_md5_dir) && $(PERL) Makefile.PL

make_math_intervalsearch: $(math_intervalsearch_dir)/Makefile
	cd $(math_intervalsearch_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)"

$(math_intervalsearch_dir)/Makefile: $(math_intervalsearch_dir)/Makefile.PL $(PERL)
	cd $(math_intervalsearch_dir) && $(PERL) Makefile.PL

make_rrdtool: $(rrdtool_dir)/Makefile $(PERL)
	cd $(rrdtool_dir) && $(MAKE) CFLAGS="$(CFLAGS)"

$(rrdtool_dir)/Makefile: $(rrdtool_dir)/config.status $(rrdtool_dir)/Makefile.in
	cd $(rrdtool_dir) && CONFIG_FILES=Makefile ./config.status

$(rrdtool_dir)/config.status:
	cd $(rrdtool_dir) && ./configure @RRD_CONFIGURE_COMMAND_LINE@

make_storable: $(storable_dir)/Makefile
	cd $(storable_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)"

$(storable_dir)/Makefile: $(storable_dir)/Makefile.PL $(PERL)
	cd $(storable_dir) && $(PERL) Makefile.PL

check:

test: check

test_modules: $(TEST_TARGETS)

test_data_dumper: $(data_dumper_dir)/Makefile
	cd $(data_dumper_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" test

test_date_parse: $(date_parse_dir)/Makefile
	cd $(date_parse_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" test

test_devel_dprof: $(devel_dprof_dir)/Makefile
	cd $(devel_dprof_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" test

test_digest_md5: $(digest_md5_dir)/Makefile
	cd $(digest_md5_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" test

test_math_intervalsearch: $(math_intervalsearch_dir)/Makefile
	cd $(math_intervalsearch_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" test

test_rrdtool: make_rrdtool
	cd $(rrdtool_dir)/perl-shared && $(MAKE) CFLAGS="$(CFLAGS)" test

test_storable: $(storable_dir)/Makefile
	cd $(storable_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" test

install: $(INSTALL_LIB_TARGETS)

install_lib_rrdtool: make_rrdtool
	cd $(rrdtool_dir)/src && $(MAKE) CFLAGS="$(CFLAGS)" install-libLTLIBRARIES

install_modules: $(INSTALL_PERL_TARGETS)

install_perl_data_dumper: $(data_dumper_dir)/Makefile
	cd $(data_dumper_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

install_perl_date_parse: $(date_parse_dir)/Makefile
	cd $(date_parse_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

install_perl_devel_dprof: $(devel_dprof_dir)/Makefile
	cd $(devel_dprof_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

install_perl_digest_md5: $(digest_md5_dir)/Makefile
	cd $(digest_md5_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

install_perl_math_intervalsearch: $(math_intervalsearch_dir)/Makefile
	cd $(math_intervalsearch_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

install_perl_rrdtool: make_rrdtool
	cd $(rrdtool_dir)/perl-shared && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

install_perl_storable: $(storable_dir)/Makefile
	cd $(storable_dir) && $(MAKE) OPTIMIZE="$(CFLAGS)" UNINST="$(UNINST)" install

clean: $(CLEAN_TARGETS)

clean_data_dumper:
	if test -r $(data_dumper_dir)/Makefile; then \
	  echo making clean in $(data_dumper_dir); \
	  (cd $(data_dumper_dir) && $(MAKE) clean) || exit 1; \
	fi

clean_date_parse:
	if test -r $(date_parse_dir)/Makefile; then \
	  echo making clean in $(date_parse_dir); \
	  (cd $(date_parse_dir) && $(MAKE) clean) || exit 1; \
	fi

clean_devel_dprof:
	if test -r $(devel_dprof_dir)/Makefile; then \
	  echo making clean in $(devel_dprof_dir); \
	  (cd $(devel_dprof_dir) && $(MAKE) clean) || exit 1; \
	fi

clean_digest_md5:
	if test -r $(digest_md5_dir)/Makefile; then \
	  echo making clean in $(digest_md5_dir); \
	  (cd $(digest_md5_dir) && $(MAKE) clean) || exit 1; \
	fi

clean_math_intervalsearch:
	if test -r $(math_intervalsearch_dir)/Makefile; then \
	  echo making clean in $(math_intervalsearch_dir); \
	  (cd $(math_intervalsearch_dir) && $(MAKE) clean) || exit 1; \
	fi

clean_rrdtool:
	cd $(rrdtool_dir) && $(MAKE) clean

clean_storable:
	if test -r $(storable_dir)/Makefile; then \
	  echo making clean in $(storable_dir); \
	  (cd $(storable_dir) && $(MAKE) clean) || exit 1; \
	fi

distclean: $(DISTCLEAN_TARGETS)
	$(RM) Makefile

distclean_data_dumper:         clean_data_dumper

distclean_date_parse:          clean_date_parse

distclean_devel_dprof:         clean_devel_dprof

distclean_digest_md5:          clean_digest_md5

distclean_math_intervalsearch: clean_math_intervalsearch

distclean_rrdtool:             clean_rrdtool
	cd $(rrdtool_dir) && $(MAKE) distclean

distclean_storable:            clean_storable

Makefile: Makefile.in
	cd .. && CONFIG_FILES=packages/Makefile ./config.status
