@SET_MAKE@

prefix            = @prefix@
exec_prefix       = @exec_prefix@
bindir            = @bindir@
libdir            = @libdir@
INSTALL           = @INSTALL@
MKDIR             = @MKDIR@
PERL_HEAD         = @PERL_HEAD@
VAR_DIR           = @VAR_DIR@
RRD_DIR           = @RRD_DIR@
RRDTOOL_DIR       = @RRDTOOL_DIR@
ORCA_SERVICES_DIR = $(VAR_DIR)/orca_services
PERL_SCRIPTS      = orca_services_running \
                    orca_services.pl
SHELL_SCRIPTS     = restart_orca_services \
                    stop_orca_services \
                    start_orca_services \
                    S99orca_services
TARGETS           = $(PERL_SCRIPTS) $(SHELL_SCRIPTS)

all: Makefile $(TARGETS) orca_services.cfg

install: all
	$(MKDIR) $(bindir)
	$(MKDIR) $(libdir)
	$(MKDIR) $(RRD_DIR)/orca_services
	@for file in $(TARGETS); do \
	  echo $(INSTALL) $$file $(bindir); \
	  $(INSTALL) $$file $(bindir); \
	done
	if test -r $(libdir)/orca_services.cfg; then \
	  cp -p $(libdir)/orca_services.cfg $(libdir)/orca_services.cfg.`date +%Y-%m-%d-%H:%M:%S`; \
	fi
	$(INSTALL) -m 0644 orca_services.cfg $(libdir)
	$(INSTALL) -m 0755 orca_services.pl $(libdir)

orca_services_run_at_boot: all
	-$(RM) /etc/init.d/orca_services /etc/rc0.d/K01orca_services
	-$(RM) /etc/rc1.d/K01orca_services /etc/rc3.d/S99orca_services
	$(INSTALL) -m 0744 S99orca_services /etc/init.d/orca_services
	ln /etc/init.d/orca_services /etc/rc0.d/K01orca_services
	ln /etc/init.d/orca_services /etc/rc1.d/K01orca_services
	ln /etc/init.d/orca_services /etc/rc3.d/S99orca_services

clean:
	$(RM) $(TARGETS)

distclean: clean
	$(RM) *.sh orca_services.cfg orca_services_running.pl Makefile

.SUFFIXES: .pl .sh

.pl: $(PERL_HEAD)
	cat $(PERL_HEAD) $< > $@
	chmod 0755 $@

.sh:
	cp $< $@
	chmod 0755 $@

Makefile: Makefile.in
	cd ../.. && CONFIG_FILES=contrib/orca_services/Makefile ./config.status
	$(MAKE)

orca_services.cfg: orca_services.cfg.in
	cd ../.. && CONFIG_FILES=contrib/orca_services/orca_services.cfg ./config.status

orca_services.pl: orca_services.pl.in $(PERL_HEAD)
	cd ../.. && CONFIG_FILES=contrib/orca_services/orca_services.pl ./config.status
	cat $(PERL_HEAD) orca_services.pl > orca_services.perl
	mv orca_services.perl orca_services.pl
	chmod 0755 orca_services.pl

orca_services_running.pl: orca_services_running.pl.in
	cd ../.. && CONFIG_FILES=contrib/contrib/orca_services/orca_services_running.pl ./config.status

restart_orca_services.sh: restart_orca_services.sh.in
	cd ../.. && CONFIG_FILES=contrib/contrib/orca_services/restart_orca_services.sh ./config.status

start_orca_services.sh: start_orca_services.sh.in
	cd ../.. && CONFIG_FILES=contrib/contrib/orca_services/start_orca_services.sh ./config.status

stop_orca_services.sh: stop_orca_services.sh.in
	cd ../.. && CONFIG_FILES=contrib/contrib/orca_services/stop_orca_services.sh ./config.status

S99orca_services.sh: S99orca_services.sh.in
	cd ../.. && CONFIG_FILES=contrib/contrib/orca_services/S99orca_services.sh ./config.status
