@SET_MAKE@

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
libdir		= @libdir@
INSTALL		= @INSTALL@
MKDIR		= @MKDIR@
PERL_HEAD	= @PERL_HEAD@
ORCALLATOR_DIR	= @ORCALLATOR_DIR@/../orcaservices
ORCASERVICES_DIR	= @ORCALLATOR_DIR@/../orcaservices
RRD_DIR		= @RRD_DIR@
RRDTOOL_DIR	= @RRDTOOL_DIR@
PERL_SCRIPTS	= orcaservices_running orcaservices.pl
SHELL_SCRIPTS	= restart_orcaservices stop_orcaservices start_orcaservices \
		  S99orcaservices
TARGETS		= $(PERL_SCRIPTS) $(SHELL_SCRIPTS)

all:		Makefile $(TARGETS) orcaservices.cfg

install: all
		$(MKDIR) $(bindir)
		$(MKDIR) $(libdir)
		$(MKDIR) $(RRD_DIR)/orcaservices
		@for file in $(TARGETS); do			\
			echo $(INSTALL) $$file $(bindir);	\
			$(INSTALL) $$file $(bindir);		\
		done
		if test -r $(libdir)/orcaservices.cfg; then	\
			cp -p $(libdir)/orcaservices.cfg $(libdir)/orcaservices.cfg.`date +%Y-%m-%d-%H:%M:%S`; \
		fi
		$(INSTALL) -m 0644 orcaservices.cfg $(libdir)
		$(INSTALL) -m 0755 orcaservices.pl $(libdir)

orcaservices_run_at_boot: all
		-$(RM) /etc/init.d/orcaservices /etc/rc0.d/K01orcaservices
		-$(RM) /etc/rc1.d/K01orcaservices /etc/rc3.d/S99orcaservices
		$(INSTALL) -m 0744 S99orcaservices /etc/init.d/orcaservices
		ln /etc/init.d/orcaservices /etc/rc0.d/K01orcaservices
		ln /etc/init.d/orcaservices /etc/rc1.d/K01orcaservices
		ln /etc/init.d/orcaservices /etc/rc3.d/S99orcaservices

clean:
		$(RM) $(TARGETS)

distclean:	clean
		$(RM) *.sh orcaservices.cfg orcaservices_running.pl Makefile

.SUFFIXES:	.pl .sh

.pl:		$(PERL_HEAD)
		cat $(PERL_HEAD) $< > $@
		chmod 0755 $@

.sh:
		cp $< $@
		chmod 0755 $@

Makefile:	Makefile.in
		cd ../.. && CONFIG_FILES=contrib/orcaservices/Makefile ./config.status
		$(MAKE)

orcaservices.cfg:			orcaservices.cfg.in
		cd ../.. && CONFIG_FILES=contrib/orcaservices/orcaservices.cfg ./config.status

orcaservices.pl:		orcaservices.pl.in	$(PERL_HEAD)
		cd ../.. && CONFIG_FILES=contrib/orcaservices/orcaservices.pl ./config.status
		cat $(PERL_HEAD) orcaservices.pl > orcaservices.perl
		mv orcaservices.perl orcaservices.pl
		chmod 0755 orcaservices.pl

orcaservices_running.pl:		orcaservices_running.pl.in
		cd ../.. && CONFIG_FILES=contrib/contrib/orcaservices/orcaservices_running.pl ./config.status

restart_orcaservices.sh:		restart_orcaservices.sh.in
		cd ../.. && CONFIG_FILES=contrib/contrib/orcaservices/restart_orcaservices.sh ./config.status

start_orcaservices.sh:		start_orcaservices.sh.in
		cd ../.. && CONFIG_FILES=contrib/contrib/orcaservices/start_orcaservices.sh ./config.status

stop_orcaservices.sh:		stop_orcaservices.sh.in
		cd ../.. && CONFIG_FILES=contrib/contrib/orcaservices/stop_orcaservices.sh ./config.status

S99orcaservices.sh:		S99orcaservices.sh.in
		cd ../.. && CONFIG_FILES=contrib/contrib/orcaservices/S99orcaservices.sh ./config.status
